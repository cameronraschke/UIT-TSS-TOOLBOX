#!/usr/bin/php
<?php
include('/var/lib/UIT-TSS-TOOLBOX/DB-connect-local.php');

$date = date('Y-m-d',time());
$time = date('Y-m-d H:i:s', time());

$default = "NULL";
$status = "functioning";

$stdin = fopen('php://stdin', 'r');
$line = trim(fgets(STDIN));

$arr = explode(',', $line);

if ($arr[0] == "begin") {
    $tagNum = $arr[1];
    $location = "Plugged in and booted on laptop table.";
}

if ($arr[0] == "end") {
    $tagNum = $arr[1];
    $location = "Finished work on laptop table.";
}

if ($arr[0] == "custom") {
    $tagNum = $arr[1];
    $location = $arr[2];
}

$conn->query("INSERT INTO locations(tagnumber,chassis_serial,location,status,problem,time) VALUES ('$tagNum',$default,'$location','$status',$default,'$time')");

#Update Serial Numbers
$sql = $conn->query("SELECT chassis_serial FROM clientstats WHERE tagnumber = '$tagNum'");
$results = $conn->query($sql);
while ($row = $results->fetch_assoc()) {
    $sql = "UPDATE locations SET chassis_serial = '" . $row['chassis_serial'] . "' WHERE tagnumber = '$tagNum'";
    $conn->query($sql);
}

?>