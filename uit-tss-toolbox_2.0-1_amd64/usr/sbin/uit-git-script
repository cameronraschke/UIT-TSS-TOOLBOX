#!/bin/bash

if [[ "$EUID" > 0 ]]; then 
  echo "Please run as root. Exiting..."
  exit 1
fi

if [[ ! -f /home/cameron/.uit-passwd ]]; then
  echo "/home/cameron/.uit-passwd is missing. Exiting..."
  echo "Make sure all variables in .uit-password are set."
  exit 1
fi

git clone https://github.com/cameronraschke/UIT-TSS-TOOLBOX /tmp/UIT-TSS-TOOLBOX/

if [[ -d /tmp/UIT-TSS-TOOLBOX/uit-tss-toolbox_2.0-1_amd64 ]]; then
  dpkg --purge uit-toolbox
fi

chmod 755 /tmp/UIT-TSS-TOOLBOX/uit-tss-toolbox_2.0-1_amd64/DEBIAN/postinst
dpkg-deb --build /tmp/UIT-TSS-TOOLBOX/uit-tss-toolbox_2.0-1_amd64/ /tmp/UIT-TSS-TOOLBOX/uit-tss-toolbox_2.0-1_amd64.deb
dpkg --install /tmp/UIT-TSS-TOOLBOX/uit-tss-toolbox_2.0-1_amd64.deb

rm -r /tmp/UIT-TSS-TOOLBOX/